__author__ = 'hao'
import os, re, json

flag = False
dir = '/media/hao/Hitachi/APKDetails/GetAPKDetails-master/'
category = 'MUSIC_AND_AUDIO'
outdir = dir + category + '_LOC/'
appdir = dir + category + '/'  # APP_WALLPAPER
os.system('mkdir ' + outdir)

if flag:

    list = os.listdir(appdir)  # list files at current dir
    for fline in list:
        os.system('python ' + dir + 'GetApkDetails.py ' + appdir + fline + ' > ' + appdir + fline + '.json')
        os.system('rm ' + appdir + '*-unpack' + ' -r -f ')
else:
    fline_pattern = re.compile(r'(.*).json')
    no_loc_pattern = re.compile(r'.*(weather)|(loca).*')
    location_pattern = re.compile(r'.*LOCATION.*')
    list = os.listdir(appdir) # list files at current dir
    counter = 0
    for fline in list:
        if fline_pattern.match(fline):# and not no_loc_pattern.match(fline):
            file = open(appdir + fline)
            apkjson = json.load(file)
            # print fline
            permission = apkjson[0]["usesPermissionArray"]
            if location_pattern.match(str(permission)):
                counter += 1
                apkname = fline.split('.json')[0]
                print apkname
                print permission
                os.system('cp ' + appdir + '/' + apkname + ' ' + outdir)
                os.system('cp ' + appdir + '/' + fline + ' ' + outdir)
    print counter